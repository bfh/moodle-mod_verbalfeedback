{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_verbalfeedback/view\n * @class      view\n * @copyright  2020 Kevin Tippenhauer <kevin.tippenhauer@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'core/modal_save_cancel',\n    'core/modal_events'\n], function($, Templates, notification, ajax, Str, Modal, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{VIEW_FEEDBACK: string, DECLINE_FEEDBACK: string}}\n     */\n    var ACTIONS = {\n        VIEW_FEEDBACK: '[data-action=\"view-feedback\"]',\n        DECLINE_FEEDBACK: '[data-action=\"decline-feedback\"]',\n        UNDO_DECLINE: '[data-action=\"undo-decline\"]'\n    };\n\n    var verbalfeedbackid;\n\n    /**\n     * Refresh the list of participants.\n     */\n    function refreshParticipantsList() {\n        // Refresh the list of participants thru AJAX.\n        var promises = ajax.call([\n            {methodname: 'mod_verbalfeedback_data_for_participant_list', args: {verbalfeedbackid: verbalfeedbackid}}\n        ]);\n        $.when(promises[0]).then(function(response) {\n            return Templates.render('mod_verbalfeedback/list_participants', response);\n\n        }).done(function(compiledSource, js) {\n            $('[data-region=\"participantlist\"]').replaceWith(compiledSource);\n            Templates.runTemplateJS(js);\n\n        }).fail(notification.exception);\n    }\n\n    var view = function(id) {\n        verbalfeedbackid = id;\n        this.registerEvents();\n    };\n\n    view.prototype.registerEvents = function() {\n        $(ACTIONS.DECLINE_FEEDBACK).click(function(e) {\n            e.preventDefault();\n\n            var statusid = $(this).data('statusid');\n            var name = $(this).data('name');\n            var context = {\n                statusid: statusid,\n                name: name\n            };\n            var declineTemplatePromise = Templates.render('mod_verbalfeedback/decline_feedback', context);\n            var titlePromise = Str.get_string('declinefeedback', 'mod_verbalfeedback');\n\n            $.when(titlePromise).then(function(title) {\n                return Modal.create({\n                    title: title,\n                    body: declineTemplatePromise,\n                    large: true,\n                });\n            }).done(function(modal) {\n                // Display the dialogue.\n                modal.show();\n\n                // On hide handler.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy modal when hidden.\n                    modal.destroy();\n                });\n\n                modal.getRoot().on(ModalEvents.save, function() {\n                    var statusid = $(\"#decline-statusid\").val();\n                    var reason = $(\"#decline-reason\").val().trim();\n                    var data = {\n                        statusid: statusid,\n                        declinereason: reason\n                    };\n\n                    var method = 'mod_verbalfeedback_decline_feedback';\n\n                    // Refresh the list of questions thru AJAX.\n                    var promises = ajax.call([\n                        {methodname: method, args: data}\n                    ]);\n                    promises[0].done(function() {\n                        refreshParticipantsList();\n                    }).fail(notification.exception);\n                });\n            }).fail(notification.exception);\n        });\n\n        $(ACTIONS.UNDO_DECLINE).click(function(e) {\n            e.preventDefault();\n\n            var statusid = $(this).data('statusid');\n            var data = {\n                statusid: statusid\n            };\n\n            var method = 'mod_verbalfeedback_undo_decline';\n\n            // Refresh the list of questions thru AJAX.\n            var promises = ajax.call([\n                {methodname: method, args: data}\n            ]);\n            promises[0].done(function() {\n                refreshParticipantsList();\n            }).fail(notification.exception);\n        });\n    };\n\n    return view;\n});\n"],"names":["define","$","Templates","notification","ajax","Str","Modal","ModalEvents","verbalfeedbackid","ACTIONS","refreshParticipantsList","promises","call","methodname","args","when","then","response","render","done","compiledSource","js","replaceWith","runTemplateJS","fail","exception","view","id","registerEvents","prototype","click","e","preventDefault","context","statusid","this","data","name","declineTemplatePromise","titlePromise","get_string","title","create","body","large","modal","show","getRoot","on","hidden","destroy","save","val","declinereason","trim"],"mappings":";;;;;;;;AAuBAA,iCAAO,CACH,SACA,iBACA,oBACA,YACA,WACA,yBACA,sBACD,SAASC,EAAGC,UAAWC,aAAcC,KAAMC,IAAKC,MAAOC,iBAalDC,iBANAC,yBAEkB,mCAFlBA,qBAGc,wCAQTC,8BAEDC,SAAWP,KAAKQ,KAAK,CACrB,CAACC,WAAY,+CAAgDC,KAAM,CAACN,iBAAkBA,qBAE1FP,EAAEc,KAAKJ,SAAS,IAAIK,MAAK,SAASC,iBACvBf,UAAUgB,OAAO,uCAAwCD,aAEjEE,MAAK,SAASC,eAAgBC,IAC7BpB,EAAE,mCAAmCqB,YAAYF,gBACjDlB,UAAUqB,cAAcF,OAEzBG,KAAKrB,aAAasB,eAGrBC,KAAO,SAASC,IAChBnB,iBAAmBmB,QACdC,yBAGTF,KAAKG,UAAUD,eAAiB,WAC5B3B,EAAEQ,0BAA0BqB,OAAM,SAASC,GACvCA,EAAEC,qBAIEC,QAAU,CACVC,SAHWjC,EAAEkC,MAAMC,KAAK,YAIxBC,KAHOpC,EAAEkC,MAAMC,KAAK,SAKpBE,uBAAyBpC,UAAUgB,OAAO,sCAAuCe,SACjFM,aAAelC,IAAImC,WAAW,kBAAmB,sBAErDvC,EAAEc,KAAKwB,cAAcvB,MAAK,SAASyB,cACxBnC,MAAMoC,OAAO,CAChBD,MAAOA,MACPE,KAAML,uBACNM,OAAO,OAEZzB,MAAK,SAAS0B,OAEbA,MAAMC,OAGND,MAAME,UAAUC,GAAGzC,YAAY0C,QAAQ,WAEnCJ,MAAMK,aAGVL,MAAME,UAAUC,GAAGzC,YAAY4C,MAAM,eAG7Bf,KAAO,CACPF,SAHWjC,EAAE,qBAAqBmD,MAIlCC,cAHSpD,EAAE,mBAAmBmD,MAAME,QASzBlD,KAAKQ,KAAK,CACrB,CAACC,WAJQ,sCAIYC,KAAMsB,QAEtB,GAAGjB,MAAK,WACbT,6BACDc,KAAKrB,aAAasB,iBAE1BD,KAAKrB,aAAasB,cAGzBxB,EAAEQ,sBAAsBqB,OAAM,SAASC,GACnCA,EAAEC,qBAGEI,KAAO,CACPF,SAFWjC,EAAEkC,MAAMC,KAAK,aAQbhC,KAAKQ,KAAK,CACrB,CAACC,WAJQ,kCAIYC,KAAMsB,QAEtB,GAAGjB,MAAK,WACbT,6BACDc,KAAKrB,aAAasB,eAItBC"}
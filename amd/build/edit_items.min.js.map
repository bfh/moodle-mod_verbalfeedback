{"version":3,"file":"edit_items.min.js","sources":["../src/edit_items.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_verbalfeedback/edit_items\n * @class      edit_items\n * @copyright  2020 Kevin Tippenhauer <kevin.tippenhauer@bfh.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'core/yui'\n], function($, Notification, Ajax) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{CATEGORY_PERCENTAGE_CHANGED: string}, {ITEM_MULTIPLIER_CHANGED: string}}\n     */\n    let ACTIONS = {\n        CATEGORY_PERCENTAGE_CHANGED: '[data-action=\"change-category-percentage\"]',\n        ITEM_MULTIPLIER_CHANGED: '[data-action=\"change-item-multiplier\"]',\n    };\n\n    let editItems = function() {\n        this.registerEvents();\n    };\n\n    let updateSum = function() {\n        let sum = 0.00;\n        $('.category-percentage').each(function() {\n            sum += parseFloat($(this).val());\n        });\n\n        if (sum != 1) {\n            $('.category-percentage').addClass('is-invalid');\n            $('#percentage-total').addClass('text-danger');\n            $('#percentage-total-value').text(parseFloat(sum * 100).toFixed(2));\n        } else {\n            $('.category-percentage').removeClass('is-invalid');\n            $('#percentage-total').removeClass('text-danger');\n            $('#percentage-total-value').text(parseFloat(sum * 100).toFixed(2));\n        }\n    };\n\n    editItems.callCategoryAction = function(action, elem) {\n        updateSum();\n\n        let promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    categoryid: elem.data('categoryid'),\n                    percentage: elem.val()\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n            if (response.success) {\n              elem.next().stop(true, true).show().fadeOut(1000);\n            } else {\n              let warnings = response.warnings.join($('<br/>'));\n              throw new Error(warnings);\n            }\n        }).fail(Notification.exception);\n    };\n\n    editItems.callItemAction = function(action, elem) {\n        let promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    itemid: elem.data('itemid'),\n                    multiplier: elem.val()\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n          if (response.success) {\n            elem.next().stop(true, true).show().fadeOut(1000);\n          } else {\n            let warnings = response.warnings.join($('<br />'));\n            throw new Error(warnings);\n          }\n        }).fail(Notification.exception);\n    };\n\n    editItems.prototype.registerEvents = function() {\n\n        $(ACTIONS.CATEGORY_PERCENTAGE_CHANGED).change(function(e) {\n            e.preventDefault();\n            editItems.callCategoryAction('mod_verbalfeedback_update_category_percentage', $(this));\n\n        });\n\n        $(ACTIONS.ITEM_MULTIPLIER_CHANGED).change(function(e) {\n            e.preventDefault();\n            if (this.value > 5) {\n              this.value = 5.00;\n            }\n            this.value = parseFloat(this.value).toFixed(2);\n            editItems.callItemAction('mod_verbalfeedback_update_item_multiplier', $(this));\n        });\n    };\n\n    editItems.prototype.updatePercentageSum = updateSum;\n    return editItems;\n});\n"],"names":["define","$","Notification","Ajax","ACTIONS","editItems","registerEvents","updateSum","sum","each","parseFloat","this","val","addClass","text","toFixed","removeClass","callCategoryAction","action","elem","call","methodname","args","categoryid","data","percentage","done","response","success","warnings","join","Error","next","stop","show","fadeOut","fail","exception","callItemAction","itemid","multiplier","prototype","change","e","preventDefault","value","updatePercentageSum"],"mappings":";;;;;;;;AAuBAA,uCAAO,CACH,SACA,oBACA,YACA,WACA,aACD,SAASC,EAAGC,aAAcC,UAOrBC,oCAC6B,6CAD7BA,gCAEyB,yCAGzBC,UAAY,gBACPC,kBAGLC,UAAY,eACRC,IAAM,EACVP,EAAE,wBAAwBQ,MAAK,WAC3BD,KAAOE,WAAWT,EAAEU,MAAMC,UAGnB,GAAPJ,KACAP,EAAE,wBAAwBY,SAAS,cACnCZ,EAAE,qBAAqBY,SAAS,eAChCZ,EAAE,2BAA2Ba,KAAKJ,WAAiB,IAANF,KAAWO,QAAQ,MAEhEd,EAAE,wBAAwBe,YAAY,cACtCf,EAAE,qBAAqBe,YAAY,eACnCf,EAAE,2BAA2Ba,KAAKJ,WAAiB,IAANF,KAAWO,QAAQ,aAIxEV,UAAUY,mBAAqB,SAASC,OAAQC,MAC5CZ,YAEeJ,KAAKiB,KAAK,CACrB,CACIC,WAAYH,OACZI,KAAM,CACFC,WAAYJ,KAAKK,KAAK,cACtBC,WAAYN,KAAKP,UAIpB,GAAGc,MAAK,SAASC,cAClBA,SAASC,QAEN,KACDC,SAAWF,SAASE,SAASC,KAAK7B,EAAE,gBAClC,IAAI8B,MAAMF,UAHhBV,KAAKa,OAAOC,MAAK,GAAM,GAAMC,OAAOC,QAAQ,QAK/CC,KAAKlC,aAAamC,YAGzBhC,UAAUiC,eAAiB,SAASpB,OAAQC,MACzBhB,KAAKiB,KAAK,CACrB,CACIC,WAAYH,OACZI,KAAM,CACFiB,OAAQpB,KAAKK,KAAK,UAClBgB,WAAYrB,KAAKP,UAIpB,GAAGc,MAAK,SAASC,cACpBA,SAASC,QAEN,KACDC,SAAWF,SAASE,SAASC,KAAK7B,EAAE,iBAClC,IAAI8B,MAAMF,UAHhBV,KAAKa,OAAOC,MAAK,GAAM,GAAMC,OAAOC,QAAQ,QAK7CC,KAAKlC,aAAamC,YAGzBhC,UAAUoC,UAAUnC,eAAiB,WAEjCL,EAAEG,qCAAqCsC,QAAO,SAASC,GACnDA,EAAEC,iBACFvC,UAAUY,mBAAmB,gDAAiDhB,EAAEU,UAIpFV,EAAEG,iCAAiCsC,QAAO,SAASC,GAC/CA,EAAEC,iBACEjC,KAAKkC,MAAQ,SACVA,MAAQ,QAEVA,MAAQnC,WAAWC,KAAKkC,OAAO9B,QAAQ,GAC5CV,UAAUiC,eAAe,4CAA6CrC,EAAEU,WAIhFN,UAAUoC,UAAUK,oBAAsBvC,UACnCF"}